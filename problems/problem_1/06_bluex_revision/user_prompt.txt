# Problem
[예시 문제1] T 세포 유전자 간 기능 유사성 정량화
T 세포에서는 항원 인식, 활성화, 분화 등 다양한 기능을 수행하는 유전자들이 네트워크 형태로 작동한다. 일반적으로 기능적으로 유사한 유전자쌍은
        •        발현 패턴(expr_corr)이 비슷하거나,
        •        단백질 구조(struct_sim)가 유사하거나,
        •        진화적 계통(phylo_sim)이 가깝다는 특징을 가진다.
문제의 목표는 발현 데이터(features)와 유전자 이름(genelist.csv, ENSMUSG+gene name)을 통합하여 유전자간 유사성 점수(Function Similarity Score)를 구축하고 이를 기준으로 유전자군을 정의하는 것이다.


입력 데이터: Q1 features 파일 
* TPM expression 파일 포함
* genelist 포함
* CD4 T, CD8 T 세포 포함
* 휴지 T 세포: naive, memory T 세포
* 활성 T 세포: TH0, TH1, TH2, TH17, TREG, 0.5/1/2/4h 등




위에 입력된 데이터를 기반으로 아래 요구 사항을 충족하는 분석 전략을 제시하라.
(1) LLM 기반 유전자 기능 요약 생성
(2) LLM 기반 phylogenic tree (knowledge-based) 생성
(3) Expression 기반 유사성 점수 생성
(4) (1,2,3) 을 통합한 Similarity Score에 따라 휴지기 T 세포 (naive or memory T 세포)조절에 주요한 유전자쌍을 제시하고, 근거와 생물학적 기능(없을시 생략 가능)을 제시하라. 
(5) 휴지기 T 세포 내 상위 발현 300개 gene을 대상으로 공개된 단백질, 도메인 정보를 활용하여 단백질 구조 유사도 점수를 생성하고 휴지기 조절에 중요한 유전자 쌍을 예측하라.


# Original Answer
Below is an **execution‑ready analysis strategy** that satisfies the five numbered requirements of the problem, using **only the provided datasets and prior evidence**.  
All steps are organized to be directly implementable, with explicit inputs, outputs, metrics, and limitations.

---

## Overview: Goal and Data Backbone

**Goal**  
Construct a **Function Similarity Score (FSS)** between T‑cell genes by integrating:
- expression similarity,
- LLM‑derived functional and evolutionary knowledge,
- and protein structural similarity,

and use this score to identify **gene pairs important for regulation of resting (naive or memory) T cells**.

**Core inputs (used consistently in all steps)**  
- `Q1.genelist.csv` (ENSMUSG ID ↔ gene_name; master key)  
- `Q1.features(nCD4).csv` (naive + activation time course)  
- `Q1.features(nCD8).csv` (naive + activation time points)  
- `Q1.features(CD4 subtypes).csv` (naive, memory, Th subsets)

**Definition of “resting T cells”**  
- Naive CD4, naive CD8, and memory CD4 T cells.

---

## (1) LLM‑based Gene Functional Summary Generation

### Objective
Create standardized, machine‑readable functional descriptions of genes in a **T‑cell‑specific context**, enabling functional similarity computation.

### Inputs
- Gene symbols from `Q1.genelist.csv`
- Context tags: *T cell*, *naive*, *memory*, *activation*

### Procedure
1. **Gene selection**  
   - Filter genes with biologically meaningful resting expression  
     (e.g., `resting_mean_TPM > 1` in CD4 subtypes or naive CD4/CD8).
2. **Prompt design (per gene)**  
   - Input: gene name + “mouse T cell biology”
   - Output fields (fixed schema):
     - Molecular type (TF, receptor, signaling, epigenetic, housekeeping)
     - Known role in naive/memory T cells (if any)
     - Role in activation/differentiation (if any)
     - Pathway/process keywords
3. **Embedding generation**  
   - Convert each functional summary into a vector embedding using the same LLM.
4. **Functional similarity metric**  
   - Compute cosine similarity between gene embeddings.

### Output
- `FuncSim_LLM(gene_i, gene_j)` ∈ [0, 1]

### Caveats
- Knowledge‑based; biased toward well‑studied genes.
- For poorly annotated genes, summaries may be generic or incomplete.

---

## (2) LLM‑based Knowledge‑Driven Phylogenetic Tree Construction

### Objective
Approximate **evolutionary / functional relatedness** between genes using **knowledge‑based hierarchies**, not sequence alignment.

### Inputs
- LLM functional summaries from (1)
- Gene family/domain hints inferred from summaries (e.g., TF families)

### Procedure
1. **Functional family grouping**
   - Cluster genes into families (e.g., TCF/LEF, RUNX, cytokine receptors).
2. **Hierarchy inference**
   - Prompt LLM to organize genes into a tree based on:
     - gene family,
     - functional specialization,
     - known regulatory roles in T cells.
3. **Tree to distance conversion**
   - Represent tree as a graph.
   - Compute **cophenetic distance** between gene pairs.
4. **Similarity transformation**
   - Convert distance to similarity:
     \[
     PhyloSim = 1 / (1 + distance)
     \]

### Output
- `PhyloSim_LLM(gene_i, gene_j)` ∈ (0, 1]

### Caveats
- Not a true molecular phylogeny.
- Captures *functional/evolutionary intuition*, not sequence homology.

---

## (3) Expression‑Based Gene Similarity Score

### Objective
Quantify **coordinated transcriptional behavior** of genes across resting and activated T‑cell states.

### Inputs
- TPM matrices from:
  - `Q1.features(nCD4).csv`
  - `Q1.features(nCD8).csv`
  - `Q1.features(CD4 subtypes).csv`

### Procedure

#### 3.1 Resting‑state co‑expression
- Conditions: naive CD4, naive CD8, memory CD4.
- Metric: **Spearman correlation** across resting samples.

#### 3.2 Resting vs activation response similarity
- Use `resting_vs_activated_log2FC` (CD4 subtypes)
- Correlate fold‑change vectors between genes.

#### 3.3 Integration
- Normalize each metric to [0,1].
- Weighted combination:
  - Resting co‑expression: **highest weight**
  - Resting–activation response: moderate weight

### Output
- `ExprSim(gene_i, gene_j)` ∈ [0,1]

### Caveats
- Correlation ≠ causation.
- Low‑TPM genes are filtered to avoid noise‑driven similarity.

---

## (4) Integrated Similarity Score and Key Gene Pairs for Resting T Cells

### Objective
Identify **gene pairs central to naive/memory T‑cell regulation** by integrating (1), (2), and (3).

### Composite Similarity Score
All scores are min–max normalized:
\[
\textbf{FSS} = w_1 \cdot ExprSim + w_2 \cdot FuncSim_{LLM} + w_3 \cdot PhyloSim_{LLM}
\]

- Default weights (justified by data availability):
  - \( w_1 = 0.5 \) (expression; data‑driven)
  - \( w_2 = 0.3 \) (functional knowledge)
  - \( w_3 = 0.2 \) (phylogenetic knowledge)

### Filtering Criteria
- Both genes expressed in resting T cells.
- FSS driven by **≥2 modalities** (not expression alone).

### High‑Confidence Gene Pairs (Examples)

| Gene pair | Evidence (modalities) | Rationale in resting T cells |
|---|---|---|
| **TCF7 – LEF1** | Expression ↑ in naive/memory, high FuncSim, same TF family | Core transcriptional regulators of naive T‑cell identity |
| **IL7R – CCR7** | Strong resting co‑expression, functional overlap | Homeostatic survival and lymphoid homing |
| **RUNX3 – BCL11B** | Expression + phylogenetic TF proximity | Maintenance of T‑cell lineage stability |
| **TCF7 – MALAT1** | Resting co‑expression, functional summary | Chromatin/transcriptional poising in quiescence |

*Biological functions are provided only where supported by known immunology; otherwise omitted.*

### Caveats
- Results are **prioritization**, not proof of interaction.
- Pairs may reflect co‑regulation rather than direct binding.

---

## (5) Protein Structure‑Based Similarity in Top 300 Resting Genes

### Objective
Use **protein structure and domain information** to identify mechanistically related gene pairs among **highly expressed resting genes**.

### Inputs
- Top 300 genes ranked by `resting_mean_TPM`
- External public resources (conceptually):
  - UniProt sequences
  - Pfam / InterPro domains
  - AlphaFold predicted structures

### Procedure

#### 5.1 Domain‑based similarity
- Extract domain sets per protein.
- Compute **Jaccard similarity** of domain composition.
- Penalize mismatched domain order.

#### 5.2 Structure‑based similarity
- Compare AlphaFold structures using **TM‑score**.
- TM‑score > 0.5 → shared fold.

#### 5.3 Structural Similarity Score
\[
StructSim = \alpha \cdot TM\text{-score} + (1-\alpha) \cdot DomainSim
\]

### Integration with FSS
- Structural similarity used as **supporting evidence**.
- Gene pairs with:
  - high FSS (from 4) **and**
  - high StructSim
  are prioritized as strongest candidates.

### Example Predictions
- **TCF7 – LEF1**: shared DNA‑binding fold and domain architecture  
- **CCR7 – S1PR1** (if in top 300): GPCR structural similarity, trafficking roles

### Caveats
- Structural similarity does not guarantee identical function.
- Analysis limited to highly expressed resting genes by design.

---

## Final Notes: Assumptions and Limitations
- No experimental interaction data are included; all results are **computational predictions**.
- LLM‑based steps depend on existing biological knowledge and may underperform for uncharacterized genes.
- Phylogenetic similarity is **knowledge‑based**, not sequence‑derived.
- The framework is modular and can be refined as new data become available.

---

**Deliverable**  
A ranked list of gene–gene pairs with:
- Expression similarity,
- LLM‑functional similarity,
- Knowledge‑based phylogenetic similarity,
- (for top genes) protein structural similarity,

prioritized for **regulation of naive and memory T‑cell quiescence**.

---

# Red Team Review Feedback
## Reliability Score
- **Score**: 85
- **Rationale**: The proposed strategy comprehensively addresses all five requirements of the prompt with a logical, multimodal approach. However, it relies heavily on heuristic weighting ($w_1, w_2, w_3$) without a ground-truth validation step, and it overlooks a critical biological noise factor: constitutive housekeeping genes, which often dominate "resting state" co-expression networks.

## Critiques / Limitations / Risks (in priority order)

1.  **Lack of Specificity Filtering (Housekeeping Gene Bias)**
    The strategy selects genes based on simple expression thresholds (`>1 TPM`) and ranks them by resting co-expression. In resting cells, the strongest co-expression signals usually come from metabolic and ribosomal genes (housekeeping) rather than lineage-specific regulators. Without filtering for T-cell specificity (e.g., specificity index vs. other tissues) or high variance, the top ranked pairs are likely to be biologically trivial (e.g., *RPL* or *ATP* synthase subunits) rather than the target regulators like *TCF7* or *CCR7*.

2.  **Arbitrary Weighting in Integration Step**
    The Composite Similarity Score (Step 4) assigns static weights (0.5, 0.3, 0.2) to expression, functional, and phylogenetic scores. These values are arbitrary. Without a "gold standard" training set (e.g., known protein-protein interactions or KEGG pathways) to regress or optimize these weights, the resulting score is purely heuristic. It is unclear if a high functional score should rescue a low expression score, or vice versa.

3.  **Instability of LLM-Generated Phylogeny**
    Step 2 proposes using an LLM to generate a phylogenetic tree based on knowledge. LLMs are non-deterministic and hallucinate relationships; asking an LLM to build a hierarchy can result in different tree topologies across runs. The strategy lacks a "bootstrapping" method (e.g., generating 100 trees and finding consensus) to ensure the `PhyloSim` metric is robust and reproducible.

4.  **Feasibility of Structural Similarity for 90,000 Pairs**
    Step 5 suggests calculating TM-scores (via AlphaFold) or domain Jaccard indices for the top 300 genes. 
    *   **Risk**: Doing pairwise structural alignment for $300 \times 299 / 2 \approx 45,000$ pairs is computationally intensive.
    *   **Data Availability**: The strategy assumes AlphaFold PDBs are readily available and identifiable for all murine T-cell genes via simple ID mapping (ENSMUSG -> UniProt), which often fails for isoforms or poorly annotated genes, leading to missing data in the matrix.

## Final Short Summary to Attach
The analysis strategy provides a coherent, "execution-ready" framework for integrating transcriptomics, LLM-derived knowledge, and structural data. It successfully outlines a method to satisfy the prompt's multimodal requirements. However, the scientific value of the results is at risk due to the likely dominance of housekeeping genes in the "resting" co-expression module and the use of unvalidated, arbitrary weights for score integration. Future iterations must include a T-cell specificity filter and a stability check for LLM-generated hierarchies.

---

# Task
Revise the original answer based on the red-team feedback, ensuring the final output **satisfies the problem’s required answer format and all requirements**.

## Guidelines
- Incorporate revisions for critiques that are scientifically valid and relevant.
- Ensure internal consistency after all revisions.
- If the problem lists numbered requirements (e.g., "(1)...(5)"), **preserve the numbering/structure**.
- **Write in English.**

## Output Requirements
- Produce a complete revised answer.
- Do not include reviewer comments, response letters, or change logs.
- **Output only the revised report text.**
