# Problem Context
You are given structured information describing a scientific research problem.

## Problem Description
Problem 1. [Troubleshooting an Ribosome Profiling Experiment]
You are given a ribosome profiling (Ribo-seq) wet-lab protocol and a set of incident reports from teams who attempted the workflow. Your job is to diagnose the root causes, propose fixes, and design a validation and prevention plan.

Provided artifact

-	protocol.md: The protocol “as distributed” to teams.
-	reference.fa: a single transcript reference sequence (toy_gene).
-	reads.fastq.gz: 50-nt single-end reads (a few hundred total).

Constraints

-	Assume no ability to run new wet-lab experiments during the competition.
-	You may propose additional experiments/QC as recommendations, but your core answers must be supported by the protocol text and the incident reports below.

Background (what “good” usually looks like)
Ribo-seq aims to sequence ribosome-protected RNA fragments. Typical success indicators include:

-	A narrow protected-fragment size distribution after digestion/selection (often ~28–34 nt; may vary by system).
-	Clear enrichment of coding-region signal and strong 3-nt periodicity in aligned reads.
-	A clean final library trace (dominant peak at expected library size, limited adapter/primer-dimer).
-	Reasonable PCR duplication; if UMIs are present, deduplication should not saturate at extremely small numbers of unique UMIs.

This protocol also encodes a UMI in the adapter/read structure (random bases denoted by N).

Competition framing
There are several issues across the incidents:

-	Some are protocol/document defects present in the originally distributed protocol.
-	There are some execution mistakes (not written in the protocol) by the experimenter. Only observations that may be derived from the mistakes are documented.

Sub-Problems
1-1. Incident A
Task: Based on the report and observations, propose the most likely root cause(s) and the next steps to confirm and fix the issue.

User report

“We followed the protocol end-to-end, but the final libraries are kind of messy and the yield jumps around between runs. Sometimes we get a decent peak; other times it’s smeary and hard to quantify.”

Observations

-	TapeStation/Bioanalyzer traces show a main library peak plus elevated baseline/smear and occasional small peaks.
-	qPCR-based quantification shows poor amplification efficiency (steeper Ct variance between replicates than expected).
-	A260/230 (when measured) is low in some runs, suggesting carryover of salts/solvents.
-	Repeating cleanup sometimes improves the trace but not consistently.

1-2. Incident B
Task: Based on the report and observations, propose the most likely root cause(s) and the next steps to confirm and fix the issue.

User report

“Same reagents and same protocol, but different people in the lab get different outcomes. PCR is sometimes fine and sometimes barely works. We didn’t intentionally change anything, so we’re not sure what part is sensitive.”

Observations

-	Strong run-to-run variability depending on operator.
-	PCR sometimes fails or needs extra cycles; when it does amplify, size looks plausible.
-	Repeat attempt with an extended bead air-dry (and careful removal of residual ethanol) restores normal amplification without changing reagents.
-	No single protocol text change explains why only some operators see the issue.

1-3. Incident C
Task: Based on the report and observations, propose the most likely root cause(s) and the next steps to confirm and fix the issue.

User report

“RNA recovery seemed OK, and the library has a peak, but the sequencing results don’t look like our past Ribo-seq runs. The fragments seem bigger than we expected and the usual ‘frame pattern’ isn’t obvious.”

Observations

-	Gel/fragment QC of protected fragments shows a broad distribution with substantial material >40 nt.
-	Sequencing QC:
-	Overall alignment rate is acceptable.
-	3-nt periodicity at P-sites is weak/near-absent.
-	Reads show increased mapping outside CDS compared to prior internal datasets.
-	Library yield after PCR is not obviously low; final library peak exists but downstream interpretability is poor.

1-4. Incident D
Task: Based on the report and observations, propose the most likely root cause(s) and the next steps to confirm and fix the issue.

User report

“The bioinformatics side is giving us strange duplication numbers. After deduplication, it looks like almost everything collapses into a tiny number of molecules, which doesn’t match how much input we started with.”

Observations

-	After UMI extraction, the number of distinct UMIs observed is extremely small.
-	Deduplication collapses a large fraction of reads even in moderately sized datasets.
-	A histogram of observed UMI strings is heavily concentrated in a tiny set; uniqueness saturates early.
-	Downstream quantification across genes is unusually noisy and sensitive to small pipeline changes.

1-5. Incident E
Task: Based on the report and observations, propose the most likely root cause(s) and the next steps to confirm and fix the issue.

User report

“We keep getting mostly short junk products instead of a clean library peak. We tried repeating the run and got basically the same outcome. We did make fresh stocks recently, but we didn’t change anything on purpose.”

Observations

-	A quick denaturing gel check right after the ligation step shows the RNA band at the same position as the pre-ligation control, with no clear shifted product band.
-	The final library trace is dominated by short artifacts; the expected library peak is weak or absent.
-	Replacing enzymes (fresh ligase, fresh buffers) does not reliably recover the expected product; the failure is reproducible across repeats.
-	Input RNA quality metrics (RIN/TapeStation) look acceptable and similar to runs that worked previously.
-	In failed sequencing runs, the first ~20–30 bases of Read 1 are highly enriched for primer/adapter-like sequence, but the expected linker-specific prefix from the protocol appears at very low frequency.
-	The new oligo shipment paperwork differs from prior orders in at least one of: molecule type (RNA vs DNA), terminal modifications, or purification grade (e.g., HPLC vs desalted).
1-6. Preliminary data analysis
You are given a small pilot Ribo-seq dataset focused on a single transcript. Process the raw FASTQ into a per-position footprint count array and summarize what the data suggests.

Expected deliverables

-	counts_raw.csv and counts_dedup.csv: counts per transcript position (state your coordinate convention clearly).
-	A histogram plot showing the distribution of 5' start positions across the transcript (raw and deduplicated side-by-side).
-	A single HTML report that, for this single-transcript dataset, summarizes basic QC suitable for Ribo-seq and your interpretation.
-	A written interpretation: what (if anything) looks biologically meaningful, and 2–4 concrete follow-up checks or next steps.


## Core Objective
Diagnose likely root causes behind multiple ribosome profiling (Ribo-seq) workflow failures reported by different teams, using only the distributed wet-lab protocol and the provided incident observations, then propose confirmatory checks, fixes, and prevention/validation plans. Additionally, analyze a small pilot Ribo-seq FASTQ dataset (single-transcript reference) to produce per-position footprint counts (raw and UMI-deduplicated) and summarize QC/interpretation in an HTML report.

# Task Details


## Suggested Direction


---

# Task
Using the information above, generate a structured scientific report that addresses the stated problem by synthesizing relevant prior research.


[List of Sub-Problems to Address]
- [1_1_Incident_A] Incident A: Messy libraries and unstable yield
  Description: Using protocol.md plus the Incident A report/observations, infer the most likely root cause(s) for smeary/variable final traces, inconsistent yield, poor qPCR efficiency, and occasional low A260/230. Propose (i) specific confirmatory checks that can be done without new wet-lab experiments (e.g., re-inspecting intermediate QC records, evaluating inhibitor signatures in qPCR, reviewing cleanup steps and reagent carryover risks), (ii) concrete protocol fixes (step edits, added warnings, acceptance criteria), and (iii) a prevention/validation plan (what to measure at which step, with pass/fail thresholds).
  Approach: 1) Protocol forensics: locate all steps that can introduce PCR inhibitors or smear (phenol/guanidinium carryover, ethanol carryover from SPRI, high-salt elutions, gel extraction reagents, over/under-drying beads, incorrect bead ratios, incomplete removal of wash). 2) Map observations to inhibitor patterns: low A260/230 + qPCR inefficiency/replicate Ct variance strongly suggests salt/solvent carryover (ethanol/PEG/guanidine). 3) Propose no-new-experiment confirmations: (a) check whether failed runs correlate with specific cleanup steps, bead lots, ethanol age, operator timing, magnet strength, or elution volume; (b) examine qPCR amplification curves for inhibition (delayed baseline, reduced efficiency); (c) if any stored intermediate files exist (TapeStation traces at earlier steps), compare smear onset step. 4) Fixes: tighten cleanup instructions (explicit ethanol removal technique, bead dry-time window, optional extra 80% EtOH wash, recommended elution buffer, spin-down before placing on magnet), add explicit A260/230 acceptance criteria and a remediation branch (repeat cleanup with defined bead ratio). 5) Prevention plan: checklist + critical control points and pass/fail thresholds (e.g., A260/230, TapeStation peak/baseline ratio, qPCR efficiency range).

- [1_2_Incident_B] Incident B: Operator-dependent PCR success
  Description: Using protocol.md plus Incident B, diagnose why different operators obtain different PCR outcomes despite identical reagents/protocol, and why extended bead air-dry and careful ethanol removal restores amplification. Provide the most likely root cause(s), the minimal confirmatory checks (without new wet-lab experiments), and protocol revisions/training controls that reduce operator sensitivity.
  Approach: 1) Identify operator-sensitive steps in protocol.md: any SPRI cleanup(s), ethanol wash/removal, bead drying, and small-volume pipetting steps. 2) Infer root cause from the key intervention: extended bead air-dry rescuing PCR is a classic signature of residual ethanol/EtOH vapor carryover inhibiting polymerase. 3) Confirmations without new experiments: (a) review run notes for drying time differences, visible residual droplets, and whether operators disturb bead pellet; (b) correlate failures with faster handling, larger elution volumes, or skipping a brief spin-down before magnet; (c) inspect qPCR curves for inhibition-like features vs. low-template features. 4) Fixes: specify a bead dry-time *range* (avoid under-dry and over-dry), require a final fine-tip aspiration of residual EtOH after magnetization, add a brief post-wash spin then return to magnet, standardize room temp and timing, and add photos/diagrams of ‘acceptable bead appearance’. 5) Prevention: implement a short operator competency checklist and include an internal amplification control spike-in recommendation for future runs to detect inhibition vs. low yield.

- [1_3_Incident_C] Incident C: Oversized footprints and weak 3-nt periodicity
  Description: Using protocol.md plus Incident C, infer the most likely causes of broad protected-fragment sizes with substantial >40 nt material, acceptable alignment but weak/absent 3-nt periodicity, and increased mapping outside CDS. Provide confirmatory checks and protocol/analysis fixes that would restore canonical Ribo-seq signatures in future runs.
  Approach: 1) Connect phenotype to failure mode: broad/long fragments and loss of periodicity commonly indicate under-digestion (wrong RNase amount/time/temp, incorrect buffer/Mg2+), incorrect monosome isolation (polysomes/disomes or free RNA contamination), or incorrect size selection (gel slice too wide/high). Increased non-CDS mapping suggests contamination by non-ribosome-protected fragments (mRNA fragments, rRNA fragments, or total RNA carryover). 2) Protocol audit: identify nuclease digestion conditions, cycloheximide/translation arrest steps (if any), sucrose gradient/cushion steps, and gel extraction/size selection instructions; look for ambiguous gel cut ranges, missing ‘stop digestion’ guidance, or missing digestion QC. 3) Confirmations without new wet-lab: (a) review any available gel images/notes to see where gel slices were cut; (b) compare fragment-size distributions reported vs expected; (c) in sequencing data (if available beyond the toy set), quantify read length distribution, CDS vs UTR mapping fraction, and periodicity metrics per read length. 4) Fixes: tighten digestion SOP (enzyme units per A260, timing, mixing, temperature, quench), require a digestion pilot titration recommendation (as a future experiment), enforce narrow size selection window (with ladder coordinates), and add an analysis-time filter to select canonical footprint lengths before periodicity assessment. 5) Prevention/validation: include acceptance criteria for footprint length distribution and per-length periodicity checks (e.g., run periodicity per read length class).

- [1_4_Incident_D] Incident D: Implausibly low UMI diversity and over-collapsing
  Description: Using protocol.md plus Incident D, diagnose why UMI extraction yields extremely few distinct UMIs and deduplication collapses most reads. Propose confirmatory checks that can be performed computationally from raw reads (or from existing outputs), and fixes to the protocol text and the bioinformatics pipeline (UMI parsing, adapter structure, read layout assumptions).
  Approach: 1) Enumerate plausible root causes: (a) UMI not truly random due to oligo synthesis/order error (Ns not randomized, wrong adapter provided, low-complexity UMI), (b) wrong UMI location/length in pipeline (off-by-k trimming, extracting constant adapter bases as ‘UMI’), (c) sequencer/read structure mismatch (UMI actually in Index read but extracted from Read 1), (d) UMI too short relative to depth causing collisions (less likely if ‘extremely small’ distinct set). 2) Computational confirmations: (a) directly inspect raw read prefixes at the expected UMI coordinates; compute per-position base composition and Shannon entropy; (b) plot UMI string frequency distribution and check if top UMIs correspond to adapter motifs; (c) verify that the ‘N’ region in protocol maps to real variable bases in reads; (d) simulate alternative extraction patterns (shifted offsets/lengths) and see if UMI complexity increases. 3) Fixes: update pipeline to use correct pattern (e.g., umi_tools extract --bc-pattern / --bc-pattern2, or custom regex) matching the protocol’s adapter/read schematic; ensure adapter trimming happens after UMI extraction (or with tools that preserve UMI bases); update protocol.md to explicitly state read layout (5'→3'), UMI length, and which read/index contains the UMI. 4) Prevention: add a required ‘UMI complexity QC’ step (entropy threshold, %N, expected uniform base frequencies) and a small preflight script for operators/analysts.

- [1_5_Incident_E] Incident E: Ligation failure and short junk products (suspected oligo issue)
  Description: Using protocol.md plus Incident E, identify the most likely root cause(s) leading to no ligation shift, dominant short artifacts, low frequency of the expected linker-specific prefix, and failure reproducibility despite enzyme replacement—especially given the new oligo shipment differences (RNA vs DNA, modifications, purification). Propose confirmatory checks possible without new wet-lab work, and specify exact ordering/specification fixes and protocol guardrails.
  Approach: 1) Failure signature mapping: no post-ligation shift + short artifacts + adapter/primer-like reads strongly implicate adapter/linker not ligating (wrong chemistry or wrong oligo). Enzyme replacement not rescuing supports substrate/specification error over enzyme failure. 2) Protocol audit: determine what the ligated oligo must be (e.g., pre-adenylated 3' adapter for truncated ligase, 5' phosphate requirement, 3' blocking to prevent concatemerization, RNA vs DNA adapter compatibility with ligase used). 3) Confirmations without new experiments: (a) compare ordered oligo specs against protocol requirements (type RNA/DNA, 5'/3' mods, pre-adenylation, phosphorylation, blocking groups, purification grade); (b) in sequencing reads, search for the exact expected linker prefix and quantify its frequency; (c) check whether observed prefixes match a different oligo sequence (e.g., primer-dimer). 4) Fixes: provide corrected oligo ordering language (full sequence + required 5'/3' modifications + purification, e.g., HPLC/PAGE), add a receiving QC checklist (verify vendor sheet fields), and add protocol callouts for ligation-positive control recommendation (future), plus an analysis preflight check that confirms linker motif presence before deep sequencing.

- [1_6_Preliminary_Data_Analysis] Pilot Ribo-seq data processing and single-transcript QC report
  Description: Process reads.fastq.gz against reference.fa (toy_gene) using the adapter/UMI structure described in protocol.md to produce: (i) counts_raw.csv and counts_dedup.csv with per-position footprint counts (clearly stating coordinate convention and whether counts reflect 5' ends, 3' ends, or inferred P-sites), (ii) a histogram plot of 5' start positions across the transcript (raw vs deduplicated side-by-side), and (iii) a single HTML report summarizing basic Ribo-seq QC for this toy single-transcript dataset and an interpretation (what looks biologically meaningful, if anything) plus 2–4 concrete follow-up checks/next steps.
  Approach: 1) Read-structure parsing: use protocol.md to determine adapter/linker sequences and UMI placement/length. Implement UMI extraction first (umi_tools extract or custom Python) and retain UMI in read header/tag. 2) Adapter/quality trimming: use cutadapt (or fastp) with explicit adapter sequence(s); verify trimming by checking residual adapter content (FastQC/MultiQC). 3) Alignment: align to reference.fa using a short-read aligner suitable for tiny references (bowtie2 in end-to-end/very-sensitive mode, or minimap2 -ax sr), then produce sorted/indexed BAM (samtools). 4) Deduplication: deduplicate by (UMI, alignment position, strand) using umi_tools dedup (or a custom dedup keyed by 5' mapping coordinate). Produce both raw and deduped per-position 5' end count arrays. 5) Outputs: define coordinate convention (recommend 1-based transcript positions; counts correspond to the 5' end of the aligned read on the transcript). Write counts_raw.csv and counts_dedup.csv with columns: position, count. Make side-by-side histograms (matplotlib/plotnine). 6) QC in HTML: include read length distribution, % trimmed, alignment rate, start-position distribution, duplication/UMI complexity metrics, and (if feasible) a simple 3-nt periodicity check by computing Fourier/periodicity score or frame counts relative to an assumed CDS start (if CDS annotation exists in protocol.md; otherwise report limitation). Use Quarto/R Markdown/Jupyter to render a single self-contained HTML.

