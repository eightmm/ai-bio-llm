# Problem Context
You are given structured information describing a scientific research problem.

## Problem Description
Problem 1. [Troubleshooting an Ribosome Profiling Experiment]
You are given a ribosome profiling (Ribo-seq) wet-lab protocol and a set of incident reports from teams who attempted the workflow. Your job is to diagnose the root causes, propose fixes, and design a validation and prevention plan.

Provided artifact

-	protocol.md: The protocol “as distributed” to teams.
-	reference.fa: a single transcript reference sequence (toy_gene).
-	reads.fastq.gz: 50-nt single-end reads (a few hundred total).

Constraints

-	Assume no ability to run new wet-lab experiments during the competition.
-	You may propose additional experiments/QC as recommendations, but your core answers must be supported by the protocol text and the incident reports below.

Background (what “good” usually looks like)
Ribo-seq aims to sequence ribosome-protected RNA fragments. Typical success indicators include:

-	A narrow protected-fragment size distribution after digestion/selection (often ~28–34 nt; may vary by system).
-	Clear enrichment of coding-region signal and strong 3-nt periodicity in aligned reads.
-	A clean final library trace (dominant peak at expected library size, limited adapter/primer-dimer).
-	Reasonable PCR duplication; if UMIs are present, deduplication should not saturate at extremely small numbers of unique UMIs.

This protocol also encodes a UMI in the adapter/read structure (random bases denoted by N).

Competition framing
There are several issues across the incidents:

-	Some are protocol/document defects present in the originally distributed protocol.
-	There are some execution mistakes (not written in the protocol) by the experimenter. Only observations that may be derived from the mistakes are documented.

Sub-Problems
1-1. Incident A
Task: Based on the report and observations, propose the most likely root cause(s) and the next steps to confirm and fix the issue.

User report

“We followed the protocol end-to-end, but the final libraries are kind of messy and the yield jumps around between runs. Sometimes we get a decent peak; other times it’s smeary and hard to quantify.”

Observations

-	TapeStation/Bioanalyzer traces show a main library peak plus elevated baseline/smear and occasional small peaks.
-	qPCR-based quantification shows poor amplification efficiency (steeper Ct variance between replicates than expected).
-	A260/230 (when measured) is low in some runs, suggesting carryover of salts/solvents.
-	Repeating cleanup sometimes improves the trace but not consistently.

1-2. Incident B
Task: Based on the report and observations, propose the most likely root cause(s) and the next steps to confirm and fix the issue.

User report

“Same reagents and same protocol, but different people in the lab get different outcomes. PCR is sometimes fine and sometimes barely works. We didn’t intentionally change anything, so we’re not sure what part is sensitive.”

Observations

-	Strong run-to-run variability depending on operator.
-	PCR sometimes fails or needs extra cycles; when it does amplify, size looks plausible.
-	Repeat attempt with an extended bead air-dry (and careful removal of residual ethanol) restores normal amplification without changing reagents.
-	No single protocol text change explains why only some operators see the issue.

1-3. Incident C
Task: Based on the report and observations, propose the most likely root cause(s) and the next steps to confirm and fix the issue.

User report

“RNA recovery seemed OK, and the library has a peak, but the sequencing results don’t look like our past Ribo-seq runs. The fragments seem bigger than we expected and the usual ‘frame pattern’ isn’t obvious.”

Observations

-	Gel/fragment QC of protected fragments shows a broad distribution with substantial material >40 nt.
-	Sequencing QC:
-	Overall alignment rate is acceptable.
-	3-nt periodicity at P-sites is weak/near-absent.
-	Reads show increased mapping outside CDS compared to prior internal datasets.
-	Library yield after PCR is not obviously low; final library peak exists but downstream interpretability is poor.

1-4. Incident D
Task: Based on the report and observations, propose the most likely root cause(s) and the next steps to confirm and fix the issue.

User report

“The bioinformatics side is giving us strange duplication numbers. After deduplication, it looks like almost everything collapses into a tiny number of molecules, which doesn’t match how much input we started with.”

Observations

-	After UMI extraction, the number of distinct UMIs observed is extremely small.
-	Deduplication collapses a large fraction of reads even in moderately sized datasets.
-	A histogram of observed UMI strings is heavily concentrated in a tiny set; uniqueness saturates early.
-	Downstream quantification across genes is unusually noisy and sensitive to small pipeline changes.

1-5. Incident E
Task: Based on the report and observations, propose the most likely root cause(s) and the next steps to confirm and fix the issue.

User report

“We keep getting mostly short junk products instead of a clean library peak. We tried repeating the run and got basically the same outcome. We did make fresh stocks recently, but we didn’t change anything on purpose.”

Observations

-	A quick denaturing gel check right after the ligation step shows the RNA band at the same position as the pre-ligation control, with no clear shifted product band.
-	The final library trace is dominated by short artifacts; the expected library peak is weak or absent.
-	Replacing enzymes (fresh ligase, fresh buffers) does not reliably recover the expected product; the failure is reproducible across repeats.
-	Input RNA quality metrics (RIN/TapeStation) look acceptable and similar to runs that worked previously.
-	In failed sequencing runs, the first ~20–30 bases of Read 1 are highly enriched for primer/adapter-like sequence, but the expected linker-specific prefix from the protocol appears at very low frequency.
-	The new oligo shipment paperwork differs from prior orders in at least one of: molecule type (RNA vs DNA), terminal modifications, or purification grade (e.g., HPLC vs desalted).
1-6. Preliminary data analysis
You are given a small pilot Ribo-seq dataset focused on a single transcript. Process the raw FASTQ into a per-position footprint count array and summarize what the data suggests.

Expected deliverables

-	counts_raw.csv and counts_dedup.csv: counts per transcript position (state your coordinate convention clearly).
-	A histogram plot showing the distribution of 5' start positions across the transcript (raw and deduplicated side-by-side).
-	A single HTML report that, for this single-transcript dataset, summarizes basic QC suitable for Ribo-seq and your interpretation.
-	A written interpretation: what (if anything) looks biologically meaningful, and 2–4 concrete follow-up checks or next steps.


## Core Objective
Diagnose failures and variability in a ribosome profiling (Ribo-seq) workflow using only the distributed wet-lab protocol and incident reports, then propose confirmatory checks, fixes, and prevention/validation steps. Additionally, process a small pilot Ribo-seq FASTQ (single-transcript reference) into per-position footprint count arrays (raw and UMI-deduplicated) and summarize QC/interpretation in an HTML report.

# Task Details


## Suggested Direction


---

# Task
Using the information above, generate a structured scientific report that addresses the stated problem by synthesizing relevant prior research.


[List of Sub-Problems to Address]
- [1_1_Incident_A] Incident A: Messy libraries and variable yield (root cause + confirm/fix plan)
  Description: Use the distributed protocol (protocol.md) together with Incident A observations to infer the most likely root cause(s) of smeary/variable library traces, poor qPCR efficiency, and intermittent low A260/230. Propose specific next-step checks that can be done without new wet-lab runs (e.g., reviewing bead cleanup steps, ethanol removal details, carryover risk points), and propose concrete protocol edits, operator checklists, and acceptance criteria to prevent recurrence. Output should explicitly map each hypothesized cause to the observations it explains and list confirmatory evidence to seek in existing artifacts/logs.
  Approach: Protocol forensics: identify all cleanup/desalting steps (silica columns, SPRI beads, ethanol washes), air-dry times, elution volumes, and any ambiguous wording that could yield solvent/salt carryover. Build a fault tree for (i) salt/ethanol/guanidinium carryover inhibiting PCR (consistent with low A260/230 + poor qPCR efficiency), (ii) over/under-drying beads affecting recovery and fragment profile, (iii) adapter/primer-dimer and partial ligation products inflating baseline/smear. Recommend confirmation using existing run metadata: cleanup timing notes, photos of pellet/beads dryness, Bioanalyzer peak ratios (library vs <150 bp artifacts), qPCR amplification curves (inhibition vs low template), and whether re-cleanup shifts A260/230 and restores qPCR slope. Prevention plan: add explicit dry-time ranges, ‘no visible droplets’ criterion, optional extra 80% EtOH wash, post-cleanup QC gate (A260/230 threshold; trace artifact fraction threshold), and a standardized operator checklist.

- [1_2_Incident_B] Incident B: Operator-dependent PCR success (sensitivity analysis + mitigation)
  Description: Use protocol.md and Incident B observations to identify steps most sensitive to operator technique that could explain PCR sometimes failing or requiring extra cycles, with recovery upon extended bead air-dry and careful ethanol removal. Propose confirmatory checks using existing records and propose a robustified protocol section (wording, timing, visual cues) and training/validation plan that reduces operator dependence.
  Approach: Focus on SPRI/EtOH wash and elution handling as the primary variable (explicitly supported by the observation that longer air-dry + ethanol removal restores amplification). Extract from protocol.md: bead ratios, number of washes, whether tubes are kept on magnet during aspiration, whether a second quick spin is recommended, whether elution is done off-magnet long enough, and whether ‘overdry’ vs ‘underdry’ guidance is provided. Recommend confirmatory checks without new wet lab: compare failed vs successful operators’ deviations (pipetting angle, aspiration depth, drying time, resuspension completeness), and inspect qPCR curves for inhibition signatures. Mitigation: add defined air-dry window (e.g., until matte appearance but not cracked), mandatory brief spin + magnet return before final aspiration, optional vacuum centrifuge step with time cap, and an internal spike-in control for PCR inhibition (if already present in existing data). Prevention: operator qualification run using a mock cleanup + qPCR efficiency gate; include photos of correct bead dryness in protocol appendix.

- [1_3_Incident_C] Incident C: Acceptable alignment but weak 3-nt periodicity and oversized fragments (interpretability failure)
  Description: Use protocol.md plus Incident C observations to infer root cause(s) that yield broad protected-fragment sizes (including >40 nt), weak/absent P-site 3-nt periodicity, and increased non-CDS mapping despite acceptable alignment rate and library yield. Propose confirmatory checks feasible without new wet-lab experiments (e.g., re-analysis of read length distributions, fragment selection window inference from sequencing, digestion/stringency checkpoints in protocol), and propose fixes + validation criteria for future runs.
  Approach: Protocol audit for nuclease digestion and size-selection: identify RNase type (RNase I vs micrococcal nuclease), digestion conditions (time, temperature, enzyme units, mixing), quench/stop conditions, and the fragment size-selection method (gel extraction window; bead-based size selection; whether rRNA depletion is used). Build hypotheses: under-digestion (too mild/short/cold; enzyme degraded; inhibitors present) leading to longer fragments and loss of periodicity; contamination by non-ribosomal RNP-protected fragments; overly broad gel cut or misinterpreted ladder leading to >40 nt carryover; mis-annotation of CDS boundaries or wrong P-site offset method (bioinformatics) as a secondary contributor. Confirmatory checks using existing data: plot read length distribution; periodicity stratified by length (periodicity often strongest at ~28–32 nt); CDS vs UTR mapping proportion by length; inspect whether long reads dominate the signal. Fixes: specify digestion titration guidance, enforce a narrow gel cut (document exact nt range and ladder reference), add acceptance gates (e.g., fraction of reads in target length window, length-resolved periodicity score), and include a standardized P-site offset table per read length in analysis SOP.

- [1_4_Incident_D] Incident D: UMI deduplication collapses to tiny unique set (UMI/design/pipeline diagnosis)
  Description: Use protocol.md and Incident D observations to diagnose why UMI diversity appears extremely small and why deduplication collapses most reads into a tiny number of molecules. Propose confirmatory checks on the read/adaptor structure and pipeline logic (UMI extraction, orientation, trimming, handling of Ns), and propose fixes and prevention tests for both protocol documentation and bioinformatics implementation.
  Approach: Protocol-to-FASTQ structure reconciliation: parse protocol.md to extract the intended read architecture (adapter sequence, number/location of random N bases for UMI, any inline barcode, whether UMI is on 5' or 3' end, whether read starts with UMI or with a linker). Enumerate failure modes: (i) UMI extracted from the wrong position (e.g., offset after trimming), (ii) UMI length mis-specified, (iii) constant bases mistakenly treated as UMI (or vice versa), (iv) low-complexity synthesis or incorrect oligo (too few random bases), (v) read1/read2 confusion if protocol implies different orientation, (vi) PCR jackpotting vs true low UMI diversity (distinguish via pre/post-trim patterns). Confirm with existing data: histogram of observed UMI strings, base composition per UMI position, entropy per position, fraction of UMIs containing ambiguous bases, and whether the ‘UMI region’ matches expected random distribution. Recommended tools: umi_tools extract/dedup (with explicit --bc-pattern and read structure), cutadapt/fastp for adapter trimming with fixed anchoring, and sanity checks by printing the first ~50 reads pre/post extraction. Prevention: add a protocol appendix that explicitly diagrams read structure; add a pipeline unit test that simulates reads with known UMIs; add acceptance gate on UMI complexity (e.g., minimum unique UMI count per 10k reads; per-position entropy threshold).

- [1_5_Incident_E] Incident E: Ligation failure and short junk products (reagent/oligo specification mismatch)
  Description: Use protocol.md and Incident E observations to infer why the ligation step fails reproducibly (no shifted ligation product band), producing short artifacts and adapter/primer-enriched read starts, with low frequency of the expected linker-specific prefix. Propose confirmatory checks possible without new wet-lab runs (paperwork/spec review, sequence/orientation checks, in-silico expectation checks), and propose fixes to reagent ordering/specifications plus a validation/prevention plan.
  Approach: Treat as an oligo/reagent specification mismatch problem strongly suggested by shipping paperwork differences (RNA vs DNA, terminal modifications, purification grade). Cross-check protocol.md for: required adapter chemistry (5' phosphate? 3' blocked end like ddC/inverted dT? pre-adenylated 5' App? RNA vs DNA adapter for specific ligase (e.g., T4 Rnl2 truncated K227Q requires pre-adenylated DNA adapter)), required modifications for directional ligation, and whether the protocol assumes a specific vendor naming convention. Confirm without wet lab: compare the expected linker prefix sequence (from protocol.md) to the observed read-start k-mer enrichment; verify whether the adapter sequence appears anywhere in reads (wrong orientation/complement is common); check for systematic absence of the adapter while primers dominate (consistent with primer-dimer/self-ligation). Recommend fixes: update ordering sheet with explicit sequences + modifications + molecule type; require HPLC purification for adapters with randomers; require certificate of analysis; implement incoming-oligo QC checklist (verify sequence, modifications, mass spec if available) and an in-silico read-structure test (simulate first cycles base composition). Prevention: include a ‘critical reagents table’ in protocol.md with vendor-neutral specification language and acceptance criteria (ligation shift on gel; presence of linker prefix in a small pilot sequencing subset).

- [1_6_Preliminary_Data_Analysis] Pilot single-transcript Ribo-seq analysis: FASTQ → per-position counts (raw + dedup) + QC report
  Description: Process reads.fastq.gz against reference.fa (single transcript) using the UMI/linker structure specified in protocol.md to produce (i) counts_raw.csv and counts_dedup.csv: per-transcript-position footprint counts, with the coordinate convention explicitly stated; (ii) a histogram plot of 5' start positions across the transcript, raw vs deduplicated side-by-side; (iii) a single HTML report summarizing basic Ribo-seq QC for this dataset (read length distribution, adapter contamination, mapping rate, duplication/UMI complexity, 3-nt periodicity if assessable on a single transcript, CDS/UTR distribution if annotation is inferable), and (iv) a short written interpretation of what looks biologically meaningful (if anything) plus 2–4 concrete follow-up checks/next steps.
  Approach: Reproducible mini-pipeline: (1) Inspect raw read structure (fastp HTML/JSON; k-mer overrepresented sequences) to infer adapter/linker presence and validate against protocol.md. (2) Adapter/linker trimming with cutadapt (anchored where possible); UMI extraction with umi_tools extract using an explicit pattern derived from protocol.md (or custom Python if the structure is nonstandard). (3) Align to reference.fa with a short-read aligner (bowtie2 in --very-sensitive-local or minimap2 -ax sr) since reference is a single transcript; keep only best alignments; record 5' start coordinate (define as 0-based from transcript 5' end, or 1-based—must be consistent across outputs). (4) Generate per-position arrays: for each read, increment the 5' start position (or optionally full footprint coverage; choose and document). Produce counts_raw.csv and counts_dedup.csv (dedup by {start_position, strand(if relevant), UMI}; if no strand ambiguity, document). (5) Plot histogram of 5' start positions raw vs dedup; optionally also show length-stratified starts. (6) QC metrics in HTML (e.g., via Quarto/RMarkdown): read length distribution pre/post trimming; fraction trimmed; mapping rate; UMI diversity (unique UMIs vs reads; per-position entropy); duplication rate; periodicity assessment: compute frame enrichment by modulo 3 of 5' starts relative to a putative CDS start if toy_gene annotation is given or infer ORF from reference (longest ORF) but clearly label as inferred. Interpretation: comment on whether starts cluster in-frame/periodic, whether dedup changes the profile dramatically (PCR jackpot), and whether read lengths match expected RPF window.

